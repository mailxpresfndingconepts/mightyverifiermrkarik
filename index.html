<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Email Verifier</title>
<style>
  body{margin:0;font-family:sans-serif;background:#0b0b0b;color:#fff;display:flex;height:100vh}
  .sidebar{width:260px;background:#111;padding:14px;display:flex;flex-direction:column}
  textarea{flex:1;resize:none;background:#000;color:#fff;border:1px solid #444;border-radius:6px;padding:8px;margin-top:8px}
  .app{flex:1;padding:20px;overflow-y:auto}
  .btn{padding:10px 16px;border-radius:6px;border:none;cursor:pointer;margin-right:10px}
  .primary{background:#12c37a;color:#000}
  .disabled{opacity:0.5;cursor:not-allowed}
  .card{background:#111;padding:14px;border-radius:8px;display:inline-block;margin:6px;text-align:center}
  .big{font-size:20px;font-weight:700}
  .muted{font-size:12px;color:#aaa}
  .progressbar{width:100%;height:10px;background:#222;border-radius:6px;margin-top:6px}
  .progressbar > div{height:100%;width:0;background:linear-gradient(90deg,#12c37a,#7be0a6);border-radius:6px}
</style>
</head>
<body>
  <div class="sidebar">
    <h3>Paste Emails</h3>
    <textarea id="pasteBox" placeholder="Paste one email per line..."></textarea>
  </div>
  <div class="app">
    <h1>Email Verifier</h1>
    <div>
      <input id="fileInput" type="file" accept=".txt" />
      <button id="startBtn" class="btn primary">Start Verification</button>
      <button id="downloadBtn" class="btn" disabled>Download Verified (.txt)</button>
    </div>
    <div id="statusArea">
      <div class="card"><div class="muted">Total</div><div id="countUploaded" class="big">0</div></div>
      <div class="card"><div class="muted">Filtered</div><div id="countFiltered" class="big">0</div></div>
      <div class="card"><div class="muted">Verified</div><div id="countVerified" class="big">0</div></div>
    </div>
    <div class="progressbar"><div id="progressFill"></div></div>
    <div class="muted" id="progressText">Idle</div>
  </div>

<script>
let uploadedEmails=[],verifiedEmails=[];

function extractEmails(text){
  return (text.match(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g)||[]).map(e=>e.toLowerCase());
}

document.getElementById("fileInput").addEventListener("change",e=>{
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=ev=>{
    uploadedEmails=extractEmails(ev.target.result||"");
    document.getElementById("countUploaded").textContent=uploadedEmails.length;
  };
  r.readAsText(f);
});

document.getElementById("startBtn").addEventListener("click",async()=>{
  const pasted=extractEmails(document.getElementById("pasteBox").value);
  let all=[...new Set([...uploadedEmails,...pasted])];

  document.getElementById("countUploaded").textContent=all.length;
  document.getElementById("progressText").textContent="Sending to server...";
  document.getElementById("progressFill").style.width="20%";

  let res=await fetch("/api/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emails:all})});
  let data=await res.json();

  document.getElementById("countFiltered").textContent=data.filteredCount;
  document.getElementById("countVerified").textContent=data.verified.length;
  document.getElementById("progressFill").style.width="100%";
  document.getElementById("progressText").textContent="Done";

  verifiedEmails=data.verified;
  document.getElementById("downloadBtn").disabled=verifiedEmails.length===0;
});

document.getElementById("downloadBtn").addEventListener("click",()=>{
  const blob=new Blob([verifiedEmails.join("\n")],{type:"text/plain"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;a.download="verified_emails.txt";a.click();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>
